{"version":3,"file":"Affix.cjs","sources":["../../../src/components/Affix/Affix.tsx"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\nimport type { ReactNode, CSSProperties } from 'react';\nimport styles from './Affix.module.css';\n\nexport interface AffixProps {\n  /** Content to be affixed */\n  children: ReactNode;\n  /** Offset from top when affixed (in pixels) */\n  offsetTop?: number;\n  /** Offset from bottom when affixed (in pixels) */\n  offsetBottom?: number;\n  /** Target container ID to affix within (defaults to window) */\n  target?: string;\n  /** Callback when affix state changes */\n  onChange?: (affixed: boolean) => void;\n  /** Additional CSS classes */\n  className?: string;\n  /** Custom z-index for affixed element */\n  zIndex?: number;\n  /** Additional inline styles */\n  style?: CSSProperties;\n}\n\n/**\n * Affix component - Makes an element stick to viewport or container on scroll\n *\n * Features:\n * - Window or container-based affixing\n * - Top or bottom positioning\n * - Custom offset configuration\n * - Placeholder maintains layout when affixed\n * - Smooth transitions\n * - Responsive behavior\n *\n * @example\n * ```tsx\n * <Affix offsetTop={64}>\n *   <Toolbar />\n * </Affix>\n * ```\n */\nexport const Affix = ({\n  children,\n  offsetTop,\n  offsetBottom,\n  target,\n  onChange,\n  className = '',\n  zIndex = 100,\n  style = {},\n}: AffixProps) => {\n  const [affixed, setAffixed] = useState(false);\n  const affixRef = useRef<HTMLDivElement>(null);\n  const placeholderRef = useRef<HTMLDivElement>(null);\n  const [affixStyle, setAffixStyle] = useState<CSSProperties>({});\n  const [placeholderStyle, setPlaceholderStyle] = useState<CSSProperties>({\n    display: 'none',\n    height: 0,\n    margin: 0,\n    padding: 0,\n  });\n\n  // Use refs to track state without causing re-renders\n  const affixedRef = useRef(false);\n  const measurementsRef = useRef({\n    originalOffsetTop: 0,\n    originalOffsetLeft: 0,\n    elementWidth: 0,\n    elementHeight: 0,\n  });\n  const rafIdRef = useRef<number | null>(null);\n\n  // Validate props\n  const hasTop = offsetTop !== undefined;\n  const hasBottom = offsetBottom !== undefined;\n\n  if (hasTop && hasBottom) {\n    console.warn('Affix: Both offsetTop and offsetBottom are set. Using offsetTop.');\n  }\n\n  const offset = hasTop ? offsetTop : offsetBottom;\n  const position = hasTop ? 'top' : 'bottom';\n\n  // Measure element dimensions and position\n  const updateMeasurements = useCallback(() => {\n    const affixElement = affixRef.current;\n    const placeholderElement = placeholderRef.current;\n    if (!affixElement || !placeholderElement) return;\n\n    const scrollContainer = target ? document.getElementById(target) : window;\n    if (!scrollContainer) return;\n\n    const rect = affixElement.getBoundingClientRect();\n    const scrollTop = scrollContainer === window ? window.scrollY : (scrollContainer as HTMLElement).scrollTop;\n    const scrollLeft = scrollContainer === window ? window.scrollX : (scrollContainer as HTMLElement).scrollLeft;\n\n    measurementsRef.current = {\n      originalOffsetTop: rect.top + scrollTop,\n      originalOffsetLeft: rect.left + scrollLeft,\n      elementWidth: rect.width,\n      elementHeight: rect.height,\n    };\n  }, [target]);\n\n  // Throttled scroll handler using requestAnimationFrame\n  const handleScroll = useCallback(() => {\n    if (rafIdRef.current !== null) return;\n\n    rafIdRef.current = requestAnimationFrame(() => {\n      rafIdRef.current = null;\n\n      const affixElement = affixRef.current;\n      if (!affixElement) return;\n\n      const scrollContainer = target ? document.getElementById(target) : window;\n      if (!scrollContainer) return;\n\n      const scrollTop = scrollContainer === window\n        ? window.scrollY\n        : (scrollContainer as HTMLElement).scrollTop;\n\n      const viewportHeight = scrollContainer === window\n        ? window.innerHeight\n        : (scrollContainer as HTMLElement).clientHeight;\n\n      const { originalOffsetTop, originalOffsetLeft, elementWidth, elementHeight } = measurementsRef.current;\n      let shouldAffix = false;\n\n      if (position === 'top') {\n        // Top affixing\n        const offsetValue = offset ?? 0;\n        shouldAffix = scrollTop > originalOffsetTop - offsetValue;\n\n        if (shouldAffix && !affixedRef.current) {\n          // Activate affix\n          affixedRef.current = true;\n          setAffixed(true);\n          setPlaceholderStyle({\n            display: 'block',\n            height: `${elementHeight}px`,\n            width: `${elementWidth}px`,\n            margin: 0,\n            padding: 0,\n            border: 'none',\n          });\n          setAffixStyle({\n            position: 'fixed',\n            top: `${offsetValue}px`,\n            left: `${originalOffsetLeft}px`,\n            width: `${elementWidth}px`,\n            zIndex,\n          });\n          onChange?.(true);\n        } else if (!shouldAffix && affixedRef.current) {\n          // Deactivate affix\n          affixedRef.current = false;\n          setAffixed(false);\n          setPlaceholderStyle({\n            display: 'none',\n            height: 0,\n            margin: 0,\n            padding: 0,\n          });\n          setAffixStyle({});\n          onChange?.(false);\n        }\n      } else {\n        // Bottom affixing\n        const offsetValue = offset ?? 0;\n        const elementBottom = originalOffsetTop + elementHeight;\n        const viewportBottom = scrollTop + viewportHeight;\n        shouldAffix = viewportBottom < elementBottom + offsetValue;\n\n        if (shouldAffix && !affixedRef.current) {\n          // Activate affix\n          affixedRef.current = true;\n          setAffixed(true);\n          setPlaceholderStyle({\n            display: 'block',\n            height: `${elementHeight}px`,\n            width: `${elementWidth}px`,\n            margin: 0,\n            padding: 0,\n            border: 'none',\n          });\n          setAffixStyle({\n            position: 'fixed',\n            bottom: `${offsetValue}px`,\n            left: `${originalOffsetLeft}px`,\n            width: `${elementWidth}px`,\n            zIndex,\n          });\n          onChange?.(true);\n        } else if (!shouldAffix && affixedRef.current) {\n          // Deactivate affix\n          affixedRef.current = false;\n          setAffixed(false);\n          setPlaceholderStyle({\n            display: 'none',\n            height: 0,\n            margin: 0,\n            padding: 0,\n          });\n          setAffixStyle({});\n          onChange?.(false);\n        }\n      }\n    });\n  }, [offset, position, target, zIndex, onChange]);\n\n  // Handle resize with measurement update\n  const handleResize = useCallback(() => {\n    // Only update measurements when not affixed to prevent jumping\n    if (!affixedRef.current) {\n      updateMeasurements();\n    }\n    handleScroll();\n  }, [updateMeasurements, handleScroll]);\n\n  // Initial measurements\n  useEffect(() => {\n    updateMeasurements();\n  }, [updateMeasurements]);\n\n  // Setup scroll and resize listeners\n  useEffect(() => {\n    const scrollContainer = target ? document.getElementById(target) : window;\n\n    if (!scrollContainer) {\n      if (target) {\n        console.warn(`Affix: Target container with id \"${target}\" not found.`);\n      }\n      return;\n    }\n\n    // Initial check\n    handleScroll();\n\n    // Add event listeners\n    if (scrollContainer === window) {\n      window.addEventListener('scroll', handleScroll, { passive: true });\n      window.addEventListener('resize', handleResize);\n    } else {\n      scrollContainer.addEventListener('scroll', handleScroll, { passive: true });\n      window.addEventListener('resize', handleResize);\n    }\n\n    // Cleanup\n    return () => {\n      if (rafIdRef.current !== null) {\n        cancelAnimationFrame(rafIdRef.current);\n      }\n\n      if (scrollContainer === window) {\n        window.removeEventListener('scroll', handleScroll);\n        window.removeEventListener('resize', handleResize);\n      } else {\n        scrollContainer.removeEventListener('scroll', handleScroll);\n        window.removeEventListener('resize', handleResize);\n      }\n    };\n  }, [offset, position, target, zIndex, handleScroll, handleResize]);\n\n  return (\n    <>\n      {/* Affixed element */}\n      <div\n        ref={affixRef}\n        className={`${styles.affix} ${affixed ? styles.affixActive : ''} ${className}`}\n        style={{ ...affixStyle, ...style }}\n        data-affixed={affixed}\n      >\n        {children}\n      </div>\n\n      {/* Placeholder to maintain layout when affixed - always rendered to maintain ref */}\n      <div\n        ref={placeholderRef}\n        style={placeholderStyle}\n        aria-hidden=\"true\"\n        className={styles.affixPlaceholder}\n      />\n    </>\n  );\n};\n"],"names":["Affix","children","offsetTop","offsetBottom","target","onChange","className","zIndex","style","affixed","setAffixed","useState","affixRef","useRef","placeholderRef","affixStyle","setAffixStyle","placeholderStyle","setPlaceholderStyle","affixedRef","measurementsRef","rafIdRef","hasTop","offset","position","updateMeasurements","useCallback","affixElement","placeholderElement","scrollContainer","rect","scrollTop","scrollLeft","handleScroll","viewportHeight","originalOffsetTop","originalOffsetLeft","elementWidth","elementHeight","shouldAffix","offsetValue","elementBottom","handleResize","useEffect","jsxs","Fragment","jsx","styles"],"mappings":"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"}