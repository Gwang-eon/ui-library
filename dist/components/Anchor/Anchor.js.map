{"version":3,"file":"Anchor.js","sources":["../../../src/components/Anchor/Anchor.tsx"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\nimport type { ReactNode } from 'react';\nimport styles from './Anchor.module.css';\n\nexport interface AnchorItem {\n  /** Unique key for the anchor item */\n  key: string;\n  /** Display title for the anchor link */\n  title: ReactNode;\n  /** Target href (must start with #) */\n  href: string;\n  /** Optional icon before the title */\n  icon?: ReactNode;\n  /** Optional nested anchor items */\n  children?: AnchorItem[];\n}\n\nexport interface AnchorProps {\n  /** Array of anchor items to display */\n  items: AnchorItem[];\n  /** Active anchor key (controlled mode) */\n  activeKey?: string;\n  /** Offset from top when scrolling to section (in pixels) */\n  offsetTop?: number;\n  /** Enable sticky positioning */\n  sticky?: boolean;\n  /** Callback when active section changes */\n  onChange?: (activeKey: string) => void;\n  /** Additional CSS classes */\n  className?: string;\n  /** Root margin for Intersection Observer (default: '-20% 0px -80% 0px') */\n  rootMargin?: string;\n  /** Smooth scroll behavior */\n  smooth?: boolean;\n}\n\n/**\n * Anchor component - Hyperlinks to scroll on one page\n *\n * Features:\n * - Automatic scroll highlighting using Intersection Observer\n * - Smooth scroll on click\n * - Support for nested anchor links\n * - Keyboard accessible (Arrow keys, Home, End)\n * - Sticky positioning option\n *\n * @example\n * ```tsx\n * <Anchor\n *   items={[\n *     { key: 'overview', title: 'Overview', href: '#overview' },\n *     { key: 'config', title: 'Configuration', href: '#config' }\n *   ]}\n *   sticky\n *   offsetTop={80}\n * />\n * ```\n */\nexport const Anchor = ({\n  items,\n  activeKey: controlledActiveKey,\n  offsetTop = 60,\n  sticky = false,\n  onChange,\n  className = '',\n  rootMargin = '-20% 0px -80% 0px',\n  smooth = true,\n}: AnchorProps) => {\n  const [activeKey, setActiveKey] = useState<string>('');\n  const anchorRef = useRef<HTMLElement>(null);\n  const linksRef = useRef<Map<string, HTMLAnchorElement>>(new Map());\n  const observerRef = useRef<IntersectionObserver | null>(null);\n\n  // Use controlled or uncontrolled active key\n  const currentActiveKey = controlledActiveKey !== undefined ? controlledActiveKey : activeKey;\n\n  // Flatten items to get all keys and hrefs\n  const flattenItems = useCallback((items: AnchorItem[]): AnchorItem[] => {\n    return items.reduce((acc: AnchorItem[], item) => {\n      acc.push(item);\n      if (item.children) {\n        acc.push(...flattenItems(item.children));\n      }\n      return acc;\n    }, []);\n  }, []);\n\n  const allItems = flattenItems(items);\n\n  // Set up Intersection Observer for scroll detection\n  useEffect(() => {\n    if (allItems.length === 0) return;\n\n    const sections: HTMLElement[] = [];\n\n    // Find all target sections\n    allItems.forEach((item) => {\n      const targetId = item.href.substring(1);\n      const section = document.getElementById(targetId);\n      if (section) {\n        sections.push(section);\n      }\n    });\n\n    if (sections.length === 0) return;\n\n    // Create Intersection Observer\n    const observerOptions: IntersectionObserverInit = {\n      rootMargin,\n      threshold: [0, 0.25, 0.5, 0.75, 1],\n    };\n\n    // Track which sections are currently visible\n    const visibleSections = new Set<string>();\n\n    observerRef.current = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          visibleSections.add(entry.target.id);\n        } else {\n          visibleSections.delete(entry.target.id);\n        }\n      });\n\n      // Get the topmost visible section\n      if (visibleSections.size > 0) {\n        const firstVisible = sections.find((section) =>\n          visibleSections.has(section.id)\n        );\n        if (firstVisible) {\n          const foundItem = allItems.find(\n            (item) => item.href === '#' + firstVisible.id\n          );\n          if (foundItem) {\n            const newActiveKey = foundItem.key;\n            if (controlledActiveKey === undefined) {\n              setActiveKey(newActiveKey);\n            }\n            onChange?.(newActiveKey);\n          }\n        }\n      }\n    }, observerOptions);\n\n    // Observe all sections\n    sections.forEach((section) => {\n      observerRef.current?.observe(section);\n    });\n\n    // Cleanup\n    return () => {\n      if (observerRef.current) {\n        sections.forEach((section) => {\n          observerRef.current?.unobserve(section);\n        });\n        observerRef.current.disconnect();\n      }\n    };\n  }, [allItems, rootMargin, onChange, controlledActiveKey]);\n\n  // Handle anchor link click\n  const handleClick = useCallback(\n    (e: React.MouseEvent<HTMLAnchorElement>, item: AnchorItem) => {\n      e.preventDefault();\n\n      const targetId = item.href.substring(1);\n      const targetSection = document.getElementById(targetId);\n\n      if (targetSection) {\n        // Calculate offset\n        const yOffset = -offsetTop;\n        const y =\n          targetSection.getBoundingClientRect().top +\n          window.pageYOffset +\n          yOffset;\n\n        // Scroll to target\n        window.scrollTo({\n          top: y,\n          behavior: smooth ? 'smooth' : 'auto',\n        });\n\n        // Update URL hash without jumping\n        if (history.pushState) {\n          history.pushState(null, '', item.href);\n        }\n\n        // Update active state\n        if (controlledActiveKey === undefined) {\n          setActiveKey(item.key);\n        }\n        onChange?.(item.key);\n      }\n    },\n    [offsetTop, smooth, controlledActiveKey, onChange]\n  );\n\n  // Keyboard navigation\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLAnchorElement>, currentIndex: number) => {\n      const allLinks = Array.from(linksRef.current.values());\n      let targetIndex: number;\n\n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          targetIndex = Math.min(currentIndex + 1, allLinks.length - 1);\n          allLinks[targetIndex]?.focus();\n          break;\n        case 'ArrowUp':\n          e.preventDefault();\n          targetIndex = Math.max(currentIndex - 1, 0);\n          allLinks[targetIndex]?.focus();\n          break;\n        case 'Home':\n          e.preventDefault();\n          allLinks[0]?.focus();\n          break;\n        case 'End':\n          e.preventDefault();\n          allLinks[allLinks.length - 1]?.focus();\n          break;\n      }\n    },\n    []\n  );\n\n  // Render anchor item\n  const renderAnchorItem = (item: AnchorItem, index: number) => {\n    const isActive = currentActiveKey === item.key;\n\n    return (\n      <div key={item.key} className={styles.anchorItem}>\n        <a\n          href={item.href}\n          ref={(el) => {\n            if (el) {\n              linksRef.current.set(item.key, el);\n            } else {\n              linksRef.current.delete(item.key);\n            }\n          }}\n          className={`${styles.anchorLink} ${isActive ? styles.active : ''}`}\n          onClick={(e) => handleClick(e, item)}\n          onKeyDown={(e) => handleKeyDown(e, index)}\n          aria-current={isActive ? 'location' : undefined}\n        >\n          {item.icon && <span className={styles.anchorIcon}>{item.icon}</span>}\n          <span>{item.title}</span>\n        </a>\n\n        {/* Render nested items */}\n        {item.children && item.children.length > 0 && (\n          <div className={styles.anchorSubmenu}>\n            {item.children.map((child, childIndex) =>\n              renderAnchorItem(child, index + childIndex + 1)\n            )}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <nav\n      ref={anchorRef}\n      className={`${styles.anchor} ${sticky ? styles.sticky : ''} ${className}`}\n      role=\"navigation\"\n      aria-label=\"Page navigation\"\n    >\n      {items.map((item, index) => renderAnchorItem(item, index))}\n    </nav>\n  );\n};\n"],"names":["Anchor","items","controlledActiveKey","offsetTop","sticky","onChange","className","rootMargin","smooth","activeKey","setActiveKey","useState","anchorRef","useRef","linksRef","observerRef","currentActiveKey","flattenItems","useCallback","acc","item","allItems","useEffect","sections","targetId","section","observerOptions","visibleSections","entries","entry","firstVisible","foundItem","newActiveKey","handleClick","targetSection","yOffset","y","handleKeyDown","currentIndex","allLinks","targetIndex","renderAnchorItem","index","isActive","jsxs","styles","el","e","jsx","child","childIndex"],"mappings":"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"}