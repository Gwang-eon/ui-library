{"version":3,"file":"PullToRefresh.cjs","sources":["../../../../src/components/mobile/PullToRefresh/PullToRefresh.tsx"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport { ArrowDown, RefreshCw } from 'lucide-react';\nimport styles from './PullToRefresh.module.css';\n\n// ==================== Pull to Refresh ====================\n\nexport type PullToRefreshStyle = 'default' | 'compact' | 'spinner';\n\nexport interface PullToRefreshProps {\n  onRefresh: () => Promise<void>;\n  children: React.ReactNode;\n  pullDistance?: number;\n  style?: PullToRefreshStyle;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport const PullToRefresh: React.FC<PullToRefreshProps> = ({\n  onRefresh,\n  children,\n  pullDistance = 80,\n  style = 'default',\n  disabled = false,\n  className = '',\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const startYRef = useRef<number>(0);\n  const currentYRef = useRef<number>(0);\n  const [pullState, setPullState] = useState<'idle' | 'pulling' | 'release' | 'refreshing'>('idle');\n  const [translateY, setTranslateY] = useState(0);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container || disabled) return;\n\n    let isPulling = false;\n\n    const handleTouchStart = (e: TouchEvent) => {\n      if (container.scrollTop === 0 && pullState === 'idle') {\n        startYRef.current = e.touches[0].clientY;\n        isPulling = true;\n      }\n    };\n\n    const handleTouchMove = (e: TouchEvent) => {\n      if (!isPulling) return;\n\n      currentYRef.current = e.touches[0].clientY;\n      const deltaY = currentYRef.current - startYRef.current;\n\n      if (deltaY > 0) {\n        e.preventDefault();\n        // Apply resistance curve\n        const resistance = 0.5;\n        const translate = Math.min(deltaY * resistance, pullDistance * 1.5);\n        setTranslateY(translate);\n\n        if (translate >= pullDistance) {\n          setPullState('release');\n        } else {\n          setPullState('pulling');\n        }\n      }\n    };\n\n    const handleTouchEnd = async () => {\n      if (!isPulling) return;\n      isPulling = false;\n\n      if (translateY >= pullDistance) {\n        setPullState('refreshing');\n        setTranslateY(pullDistance);\n\n        try {\n          await onRefresh();\n        } catch (error) {\n          console.error('Refresh error:', error);\n        } finally {\n          setPullState('idle');\n          setTranslateY(0);\n        }\n      } else {\n        setPullState('idle');\n        setTranslateY(0);\n      }\n    };\n\n    // Mouse events for desktop testing\n    let isMousePulling = false;\n\n    const handleMouseDown = (e: MouseEvent) => {\n      if (container.scrollTop === 0 && pullState === 'idle') {\n        startYRef.current = e.clientY;\n        isMousePulling = true;\n      }\n    };\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!isMousePulling) return;\n\n      currentYRef.current = e.clientY;\n      const deltaY = currentYRef.current - startYRef.current;\n\n      if (deltaY > 0) {\n        e.preventDefault();\n        const resistance = 0.5;\n        const translate = Math.min(deltaY * resistance, pullDistance * 1.5);\n        setTranslateY(translate);\n\n        if (translate >= pullDistance) {\n          setPullState('release');\n        } else {\n          setPullState('pulling');\n        }\n      }\n    };\n\n    const handleMouseUp = async () => {\n      if (!isMousePulling) return;\n      isMousePulling = false;\n\n      if (translateY >= pullDistance) {\n        setPullState('refreshing');\n        setTranslateY(pullDistance);\n\n        try {\n          await onRefresh();\n        } catch (error) {\n          console.error('Refresh error:', error);\n        } finally {\n          setPullState('idle');\n          setTranslateY(0);\n        }\n      } else {\n        setPullState('idle');\n        setTranslateY(0);\n      }\n    };\n\n    container.addEventListener('touchstart', handleTouchStart, { passive: true });\n    container.addEventListener('touchmove', handleTouchMove, { passive: false });\n    container.addEventListener('touchend', handleTouchEnd);\n\n    container.addEventListener('mousedown', handleMouseDown);\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n\n    return () => {\n      container.removeEventListener('touchstart', handleTouchStart);\n      container.removeEventListener('touchmove', handleTouchMove);\n      container.removeEventListener('touchend', handleTouchEnd);\n\n      container.removeEventListener('mousedown', handleMouseDown);\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [disabled, onRefresh, pullDistance, pullState, translateY]);\n\n  const containerClassName = `${styles.pullToRefresh} ${className}`.trim();\n\n  const contentClassName = `\n    ${styles.pullToRefreshContent}\n    ${pullState === 'pulling' ? styles.pulling : ''}\n    ${pullState === 'refreshing' ? styles.refreshing : ''}\n  `.trim();\n\n  const indicatorClassName = `\n    ${styles.pullIndicator}\n    ${translateY > 0 ? styles.visible : ''}\n    ${pullState !== 'idle' ? styles[`state${pullState.charAt(0).toUpperCase() + pullState.slice(1)}`] : ''}\n    ${style !== 'default' ? styles[`style${style.charAt(0).toUpperCase() + style.slice(1)}`] : ''}\n  `.trim();\n\n  const getPullText = () => {\n    switch (pullState) {\n      case 'pulling':\n        return 'Pull to refresh';\n      case 'release':\n        return 'Release to refresh';\n      case 'refreshing':\n        return 'Refreshing...';\n      default:\n        return 'Pull to refresh';\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      className={containerClassName}\n      style={{\n        ['--mobile-pull-distance' as string]: `${pullDistance}px`,\n      }}\n    >\n      <div className={indicatorClassName}>\n        {style === 'spinner' ? (\n          <>\n            {pullState === 'refreshing' ? (\n              <div className={styles.pullSpinner} />\n            ) : (\n              <div className={styles.pullIcon}>\n                <ArrowDown className={styles.icon} />\n              </div>\n            )}\n            <span className={styles.pullText}>{getPullText()}</span>\n          </>\n        ) : (\n          <>\n            <div className={styles.pullIcon}>\n              {pullState === 'refreshing' ? (\n                <RefreshCw className={styles.icon} />\n              ) : (\n                <ArrowDown className={styles.icon} />\n              )}\n            </div>\n            <span className={styles.pullText}>{getPullText()}</span>\n          </>\n        )}\n      </div>\n\n      <div\n        ref={contentRef}\n        className={contentClassName}\n        style={{\n          transform: `translateY(${translateY}px)`,\n        }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n\n// ==================== Main Export ====================\n\nexport default PullToRefresh;\n"],"names":["PullToRefresh","onRefresh","children","pullDistance","style","disabled","className","containerRef","useRef","contentRef","startYRef","currentYRef","pullState","setPullState","useState","translateY","setTranslateY","useEffect","container","isPulling","handleTouchStart","e","handleTouchMove","deltaY","translate","handleTouchEnd","error","isMousePulling","handleMouseDown","handleMouseMove","handleMouseUp","containerClassName","styles","contentClassName","indicatorClassName","getPullText","jsxs","jsx","Fragment","ArrowDown","RefreshCw"],"mappings":"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"}