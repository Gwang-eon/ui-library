{"version":3,"file":"PullToRefresh.js","sources":["../../../../src/components/mobile/PullToRefresh/PullToRefresh.tsx"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport { ArrowDown, RefreshCw } from 'lucide-react';\nimport styles from './PullToRefresh.module.css';\n\n// ==================== Pull to Refresh ====================\n\nexport type PullToRefreshStyle = 'default' | 'compact' | 'spinner';\n\nexport interface PullToRefreshProps {\n  onRefresh: () => Promise<void>;\n  children: React.ReactNode;\n  pullDistance?: number;\n  style?: PullToRefreshStyle;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport const PullToRefresh: React.FC<PullToRefreshProps> = ({\n  onRefresh,\n  children,\n  pullDistance = 80,\n  style = 'default',\n  disabled = false,\n  className = '',\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const startYRef = useRef<number>(0);\n  const currentYRef = useRef<number>(0);\n  const [pullState, setPullState] = useState<'idle' | 'pulling' | 'release' | 'refreshing'>('idle');\n  const [translateY, setTranslateY] = useState(0);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container || disabled) return;\n\n    let isPulling = false;\n\n    const handleTouchStart = (e: TouchEvent) => {\n      if (container.scrollTop === 0 && pullState === 'idle') {\n        startYRef.current = e.touches[0].clientY;\n        isPulling = true;\n      }\n    };\n\n    const handleTouchMove = (e: TouchEvent) => {\n      if (!isPulling) return;\n\n      currentYRef.current = e.touches[0].clientY;\n      const deltaY = currentYRef.current - startYRef.current;\n\n      if (deltaY > 0) {\n        e.preventDefault();\n        // Apply resistance curve\n        const resistance = 0.5;\n        const translate = Math.min(deltaY * resistance, pullDistance * 1.5);\n        setTranslateY(translate);\n\n        if (translate >= pullDistance) {\n          setPullState('release');\n        } else {\n          setPullState('pulling');\n        }\n      }\n    };\n\n    const handleTouchEnd = async () => {\n      if (!isPulling) return;\n      isPulling = false;\n\n      if (translateY >= pullDistance) {\n        setPullState('refreshing');\n        setTranslateY(pullDistance);\n\n        try {\n          await onRefresh();\n        } catch (error) {\n          console.error('Refresh error:', error);\n        } finally {\n          setPullState('idle');\n          setTranslateY(0);\n        }\n      } else {\n        setPullState('idle');\n        setTranslateY(0);\n      }\n    };\n\n    // Mouse events for desktop testing\n    let isMousePulling = false;\n\n    const handleMouseDown = (e: MouseEvent) => {\n      if (container.scrollTop === 0 && pullState === 'idle') {\n        startYRef.current = e.clientY;\n        isMousePulling = true;\n      }\n    };\n\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!isMousePulling) return;\n\n      currentYRef.current = e.clientY;\n      const deltaY = currentYRef.current - startYRef.current;\n\n      if (deltaY > 0) {\n        e.preventDefault();\n        const resistance = 0.5;\n        const translate = Math.min(deltaY * resistance, pullDistance * 1.5);\n        setTranslateY(translate);\n\n        if (translate >= pullDistance) {\n          setPullState('release');\n        } else {\n          setPullState('pulling');\n        }\n      }\n    };\n\n    const handleMouseUp = async () => {\n      if (!isMousePulling) return;\n      isMousePulling = false;\n\n      if (translateY >= pullDistance) {\n        setPullState('refreshing');\n        setTranslateY(pullDistance);\n\n        try {\n          await onRefresh();\n        } catch (error) {\n          console.error('Refresh error:', error);\n        } finally {\n          setPullState('idle');\n          setTranslateY(0);\n        }\n      } else {\n        setPullState('idle');\n        setTranslateY(0);\n      }\n    };\n\n    container.addEventListener('touchstart', handleTouchStart, { passive: true });\n    container.addEventListener('touchmove', handleTouchMove, { passive: false });\n    container.addEventListener('touchend', handleTouchEnd);\n\n    container.addEventListener('mousedown', handleMouseDown);\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n\n    return () => {\n      container.removeEventListener('touchstart', handleTouchStart);\n      container.removeEventListener('touchmove', handleTouchMove);\n      container.removeEventListener('touchend', handleTouchEnd);\n\n      container.removeEventListener('mousedown', handleMouseDown);\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [disabled, onRefresh, pullDistance, pullState, translateY]);\n\n  const containerClassName = `${styles.pullToRefresh} ${className}`.trim();\n\n  const contentClassName = `\n    ${styles.pullToRefreshContent}\n    ${pullState === 'pulling' ? styles.pulling : ''}\n    ${pullState === 'refreshing' ? styles.refreshing : ''}\n  `.trim();\n\n  const indicatorClassName = `\n    ${styles.pullIndicator}\n    ${translateY > 0 ? styles.visible : ''}\n    ${pullState !== 'idle' ? styles[`state${pullState.charAt(0).toUpperCase() + pullState.slice(1)}`] : ''}\n    ${style !== 'default' ? styles[`style${style.charAt(0).toUpperCase() + style.slice(1)}`] : ''}\n  `.trim();\n\n  const getPullText = () => {\n    switch (pullState) {\n      case 'pulling':\n        return 'Pull to refresh';\n      case 'release':\n        return 'Release to refresh';\n      case 'refreshing':\n        return 'Refreshing...';\n      default:\n        return 'Pull to refresh';\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      className={containerClassName}\n      style={{\n        ['--mobile-pull-distance' as string]: `${pullDistance}px`,\n      }}\n    >\n      <div className={indicatorClassName}>\n        {style === 'spinner' ? (\n          <>\n            {pullState === 'refreshing' ? (\n              <div className={styles.pullSpinner} />\n            ) : (\n              <div className={styles.pullIcon}>\n                <ArrowDown className={styles.icon} />\n              </div>\n            )}\n            <span className={styles.pullText}>{getPullText()}</span>\n          </>\n        ) : (\n          <>\n            <div className={styles.pullIcon}>\n              {pullState === 'refreshing' ? (\n                <RefreshCw className={styles.icon} />\n              ) : (\n                <ArrowDown className={styles.icon} />\n              )}\n            </div>\n            <span className={styles.pullText}>{getPullText()}</span>\n          </>\n        )}\n      </div>\n\n      <div\n        ref={contentRef}\n        className={contentClassName}\n        style={{\n          transform: `translateY(${translateY}px)`,\n        }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n\n// ==================== Main Export ====================\n\nexport default PullToRefresh;\n"],"names":["PullToRefresh","onRefresh","children","pullDistance","style","disabled","className","containerRef","useRef","contentRef","startYRef","currentYRef","pullState","setPullState","useState","translateY","setTranslateY","useEffect","container","isPulling","handleTouchStart","e","handleTouchMove","deltaY","translate","handleTouchEnd","error","isMousePulling","handleMouseDown","handleMouseMove","handleMouseUp","containerClassName","styles","contentClassName","indicatorClassName","getPullText","jsxs","jsx","Fragment","ArrowDown","RefreshCw"],"mappings":"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"}