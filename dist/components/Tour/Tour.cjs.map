{"version":3,"file":"Tour.cjs","sources":["../../../src/components/Tour/Tour.tsx"],"sourcesContent":["import type { ReactNode } from 'react';\nimport { useState, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { X } from 'lucide-react';\nimport { Button } from '../Button';\nimport styles from './Tour.module.css';\n\nexport type TourPlacement = 'top' | 'bottom' | 'left' | 'right';\n\nexport interface TourStep {\n  /** Target element selector (e.g., '#step-1', '.my-element') */\n  target: string;\n  /** Step title */\n  title: string;\n  /** Step description */\n  content: ReactNode;\n  /** Popup placement relative to target */\n  placement?: TourPlacement;\n}\n\nexport interface TourProps {\n  /** Whether the tour is open */\n  open: boolean;\n  /** Array of tour steps */\n  steps: TourStep[];\n  /** Current step index (controlled) */\n  current?: number;\n  /** Current step change callback */\n  onChange?: (current: number) => void;\n  /** Close callback */\n  onClose: () => void;\n  /** Finish callback (when last step completes) */\n  onFinish?: () => void;\n  /** Skip callback */\n  onSkip?: () => void;\n  /** Show mask overlay */\n  mask?: boolean;\n  /** Show close button */\n  closable?: boolean;\n  /** Show skip button */\n  showSkip?: boolean;\n  /** Show progress indicator */\n  showProgress?: boolean;\n  /** Default placement for all steps */\n  placement?: TourPlacement;\n  /** ARIA label */\n  'aria-label'?: string;\n}\n\n/**\n * Tour Component\n *\n * Step-by-step guide to help users understand and navigate through features.\n * Ideal for user onboarding, feature discovery, and contextual help.\n *\n * @example\n * ```tsx\n * const [tourOpen, setTourOpen] = useState(false);\n *\n * const steps: TourStep[] = [\n *   {\n *     target: '#dashboard',\n *     title: 'Dashboard',\n *     content: 'View your device metrics here',\n *     placement: 'bottom'\n *   },\n *   {\n *     target: '#settings',\n *     title: 'Settings',\n *     content: 'Configure your preferences',\n *     placement: 'left'\n *   }\n * ];\n *\n * <Tour\n *   open={tourOpen}\n *   steps={steps}\n *   onClose={() => setTourOpen(false)}\n *   onFinish={() => console.log('Tour completed')}\n * />\n * ```\n */\nexport const Tour = ({\n  open,\n  steps,\n  current: controlledCurrent,\n  onChange,\n  onClose,\n  onFinish,\n  onSkip,\n  mask = true,\n  closable = true,\n  showSkip = true,\n  showProgress = true,\n  placement: defaultPlacement = 'bottom',\n  'aria-label': ariaLabel = 'Product tour',\n}: TourProps) => {\n  const [uncontrolledCurrent, setUncontrolledCurrent] = useState(0);\n  const [popupPosition, setPopupPosition] = useState({ top: 0, left: 0 });\n  const [popupPlacement, setPopupPlacement] = useState<TourPlacement>(defaultPlacement);\n  const popupRef = useRef<HTMLDivElement>(null);\n  const previousFocusRef = useRef<HTMLElement | null>(null);\n  const [targetElement, setTargetElement] = useState<HTMLElement | null>(null);\n\n  // Determine if controlled or uncontrolled\n  const isControlled = controlledCurrent !== undefined;\n  const currentStep = isControlled ? controlledCurrent : uncontrolledCurrent;\n\n  const setCurrentStep = (index: number) => {\n    if (!isControlled) {\n      setUncontrolledCurrent(index);\n    }\n    onChange?.(index);\n  };\n\n  const step = steps[currentStep];\n\n  // Store previous focus when tour opens\n  useEffect(() => {\n    if (open) {\n      previousFocusRef.current = document.activeElement as HTMLElement;\n    } else {\n      // Return focus when tour closes\n      if (previousFocusRef.current) {\n        previousFocusRef.current.focus();\n      }\n    }\n  }, [open]);\n\n  // Update target element and highlight\n  useEffect(() => {\n    if (!open || !step) return;\n\n    // Remove previous highlight\n    document.querySelectorAll(`.${styles.tourTargetHighlight}`).forEach(el => {\n      el.classList.remove(styles.tourTargetHighlight);\n    });\n\n    // Find and highlight new target\n    const target = document.querySelector(step.target) as HTMLElement;\n    if (target) {\n      target.classList.add(styles.tourTargetHighlight);\n      setTargetElement(target);\n    }\n\n    return () => {\n      // Cleanup highlight on unmount\n      document.querySelectorAll(`.${styles.tourTargetHighlight}`).forEach(el => {\n        el.classList.remove(styles.tourTargetHighlight);\n      });\n    };\n  }, [open, step, currentStep]);\n\n  // Position popup relative to target\n  useEffect(() => {\n    if (!open || !targetElement || !popupRef.current) return;\n\n    const updatePosition = () => {\n      const targetRect = targetElement.getBoundingClientRect();\n      const popupRect = popupRef.current!.getBoundingClientRect();\n      const placement = step?.placement || defaultPlacement;\n\n      let top = 0;\n      let left = 0;\n\n      switch (placement) {\n        case 'top':\n          top = targetRect.top - popupRect.height - 12;\n          left = targetRect.left + (targetRect.width / 2) - (popupRect.width / 2);\n          break;\n        case 'right':\n          top = targetRect.top + (targetRect.height / 2) - (popupRect.height / 2);\n          left = targetRect.right + 12;\n          break;\n        case 'left':\n          top = targetRect.top + (targetRect.height / 2) - (popupRect.height / 2);\n          left = targetRect.left - popupRect.width - 12;\n          break;\n        case 'bottom':\n        default:\n          top = targetRect.bottom + 12;\n          left = targetRect.left + (targetRect.width / 2) - (popupRect.width / 2);\n          break;\n      }\n\n      // Keep within viewport\n      top = Math.max(12, Math.min(top, window.innerHeight - popupRect.height - 12));\n      left = Math.max(12, Math.min(left, window.innerWidth - popupRect.width - 12));\n\n      setPopupPosition({\n        top: top + window.pageYOffset,\n        left: left + window.pageXOffset,\n      });\n      setPopupPlacement(placement);\n    };\n\n    updatePosition();\n\n    // Update on scroll/resize\n    window.addEventListener('scroll', updatePosition);\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('scroll', updatePosition);\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [open, targetElement, step, defaultPlacement]);\n\n  // Keyboard navigation\n  useEffect(() => {\n    if (!open) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      switch (e.key) {\n        case 'Escape':\n          onClose();\n          break;\n        case 'ArrowRight':\n        case 'Enter':\n        case ' ':\n          if (e.key === ' ') e.preventDefault();\n          handleNext();\n          break;\n        case 'ArrowLeft':\n          handlePrev();\n          break;\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [open, currentStep, steps.length]);\n\n  // Prevent body scroll when tour is open\n  useEffect(() => {\n    if (open) {\n      const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;\n      document.body.style.overflow = 'hidden';\n      document.body.style.paddingRight = `${scrollbarWidth}px`;\n    } else {\n      document.body.style.overflow = '';\n      document.body.style.paddingRight = '';\n    }\n\n    return () => {\n      document.body.style.overflow = '';\n      document.body.style.paddingRight = '';\n    };\n  }, [open]);\n\n  const handleNext = () => {\n    if (currentStep < steps.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      // Finish tour\n      onFinish?.();\n      onClose();\n    }\n  };\n\n  const handlePrev = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleSkip = () => {\n    onSkip?.();\n    onClose();\n  };\n\n  const handleClose = () => {\n    onClose();\n  };\n\n  if (!open || steps.length === 0) return null;\n\n  const isFirstStep = currentStep === 0;\n  const isLastStep = currentStep === steps.length - 1;\n\n  return createPortal(\n    <>\n      {/* Mask overlay */}\n      {mask && (\n        <div\n          className={`${styles.tourMask} ${styles.tourMaskVisible}`}\n          aria-hidden=\"true\"\n        />\n      )}\n\n      {/* Tour popup */}\n      <div\n        ref={popupRef}\n        className={`${styles.tourPopup} ${styles.tourPopupVisible}`}\n        style={{\n          top: `${popupPosition.top}px`,\n          left: `${popupPosition.left}px`,\n        }}\n        data-placement={popupPlacement}\n        role=\"dialog\"\n        aria-modal=\"false\"\n        aria-label={ariaLabel}\n        aria-describedby=\"tour-content\"\n      >\n        {/* Header */}\n        <div className={styles.tourHeader}>\n          {showProgress && (\n            <div className={styles.tourProgress} aria-live=\"polite\">\n              {currentStep + 1} / {steps.length}\n            </div>\n          )}\n          {closable && (\n            <button\n              className={styles.tourClose}\n              onClick={handleClose}\n              aria-label=\"Close tour\"\n            >\n              <X size={20} />\n            </button>\n          )}\n        </div>\n\n        {/* Content */}\n        <div className={styles.tourContent} id=\"tour-content\">\n          <h4 className={styles.tourTitle}>{step.title}</h4>\n          <div className={styles.tourDescription}>{step.content}</div>\n        </div>\n\n        {/* Footer */}\n        <div className={styles.tourFooter}>\n          {showSkip ? (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleSkip}\n              className={styles.tourSkip}\n            >\n              Skip\n            </Button>\n          ) : (\n            <span />\n          )}\n          <div className={styles.tourNav}>\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={handlePrev}\n              disabled={isFirstStep}\n              className={styles.tourPrev}\n            >\n              Previous\n            </Button>\n            <Button\n              variant=\"primary\"\n              size=\"sm\"\n              onClick={handleNext}\n              className={styles.tourNext}\n            >\n              {isLastStep ? 'Finish' : 'Next'}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </>,\n    document.body\n  );\n};\n\nTour.displayName = 'Tour';\n"],"names":["Tour","open","steps","controlledCurrent","onChange","onClose","onFinish","onSkip","mask","closable","showSkip","showProgress","defaultPlacement","ariaLabel","uncontrolledCurrent","setUncontrolledCurrent","useState","popupPosition","setPopupPosition","popupPlacement","setPopupPlacement","popupRef","useRef","previousFocusRef","targetElement","setTargetElement","isControlled","currentStep","setCurrentStep","index","step","useEffect","styles","el","target","updatePosition","targetRect","popupRect","placement","top","left","handleKeyDown","handleNext","handlePrev","scrollbarWidth","handleSkip","handleClose","isFirstStep","isLastStep","createPortal","jsxs","Fragment","jsx","X","Button"],"mappings":"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"}