{"version":3,"file":"Tour.js","sources":["../../../src/components/Tour/Tour.tsx"],"sourcesContent":["import type { ReactNode } from 'react';\nimport { useState, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { X } from 'lucide-react';\nimport { Button } from '../Button';\nimport styles from './Tour.module.css';\n\nexport type TourPlacement = 'top' | 'bottom' | 'left' | 'right';\n\nexport interface TourStep {\n  /** Target element selector (e.g., '#step-1', '.my-element') */\n  target: string;\n  /** Step title */\n  title: string;\n  /** Step description */\n  content: ReactNode;\n  /** Popup placement relative to target */\n  placement?: TourPlacement;\n}\n\nexport interface TourProps {\n  /** Whether the tour is open */\n  open: boolean;\n  /** Array of tour steps */\n  steps: TourStep[];\n  /** Current step index (controlled) */\n  current?: number;\n  /** Current step change callback */\n  onChange?: (current: number) => void;\n  /** Close callback */\n  onClose: () => void;\n  /** Finish callback (when last step completes) */\n  onFinish?: () => void;\n  /** Skip callback */\n  onSkip?: () => void;\n  /** Show mask overlay */\n  mask?: boolean;\n  /** Show close button */\n  closable?: boolean;\n  /** Show skip button */\n  showSkip?: boolean;\n  /** Show progress indicator */\n  showProgress?: boolean;\n  /** Default placement for all steps */\n  placement?: TourPlacement;\n  /** ARIA label */\n  'aria-label'?: string;\n}\n\n/**\n * Tour Component\n *\n * Step-by-step guide to help users understand and navigate through features.\n * Ideal for user onboarding, feature discovery, and contextual help.\n *\n * @example\n * ```tsx\n * const [tourOpen, setTourOpen] = useState(false);\n *\n * const steps: TourStep[] = [\n *   {\n *     target: '#dashboard',\n *     title: 'Dashboard',\n *     content: 'View your device metrics here',\n *     placement: 'bottom'\n *   },\n *   {\n *     target: '#settings',\n *     title: 'Settings',\n *     content: 'Configure your preferences',\n *     placement: 'left'\n *   }\n * ];\n *\n * <Tour\n *   open={tourOpen}\n *   steps={steps}\n *   onClose={() => setTourOpen(false)}\n *   onFinish={() => console.log('Tour completed')}\n * />\n * ```\n */\nexport const Tour = ({\n  open,\n  steps,\n  current: controlledCurrent,\n  onChange,\n  onClose,\n  onFinish,\n  onSkip,\n  mask = true,\n  closable = true,\n  showSkip = true,\n  showProgress = true,\n  placement: defaultPlacement = 'bottom',\n  'aria-label': ariaLabel = 'Product tour',\n}: TourProps) => {\n  const [uncontrolledCurrent, setUncontrolledCurrent] = useState(0);\n  const [popupPosition, setPopupPosition] = useState({ top: 0, left: 0 });\n  const [popupPlacement, setPopupPlacement] = useState<TourPlacement>(defaultPlacement);\n  const popupRef = useRef<HTMLDivElement>(null);\n  const previousFocusRef = useRef<HTMLElement | null>(null);\n  const [targetElement, setTargetElement] = useState<HTMLElement | null>(null);\n\n  // Determine if controlled or uncontrolled\n  const isControlled = controlledCurrent !== undefined;\n  const currentStep = isControlled ? controlledCurrent : uncontrolledCurrent;\n\n  const setCurrentStep = (index: number) => {\n    if (!isControlled) {\n      setUncontrolledCurrent(index);\n    }\n    onChange?.(index);\n  };\n\n  const step = steps[currentStep];\n\n  // Store previous focus when tour opens\n  useEffect(() => {\n    if (open) {\n      previousFocusRef.current = document.activeElement as HTMLElement;\n    } else {\n      // Return focus when tour closes\n      if (previousFocusRef.current) {\n        previousFocusRef.current.focus();\n      }\n    }\n  }, [open]);\n\n  // Update target element and highlight\n  useEffect(() => {\n    if (!open || !step) return;\n\n    // Remove previous highlight\n    document.querySelectorAll(`.${styles.tourTargetHighlight}`).forEach(el => {\n      el.classList.remove(styles.tourTargetHighlight);\n    });\n\n    // Find and highlight new target\n    const target = document.querySelector(step.target) as HTMLElement;\n    if (target) {\n      target.classList.add(styles.tourTargetHighlight);\n      setTargetElement(target);\n    }\n\n    return () => {\n      // Cleanup highlight on unmount\n      document.querySelectorAll(`.${styles.tourTargetHighlight}`).forEach(el => {\n        el.classList.remove(styles.tourTargetHighlight);\n      });\n    };\n  }, [open, step, currentStep]);\n\n  // Position popup relative to target\n  useEffect(() => {\n    if (!open || !targetElement || !popupRef.current) return;\n\n    const updatePosition = () => {\n      const targetRect = targetElement.getBoundingClientRect();\n      const popupRect = popupRef.current!.getBoundingClientRect();\n      const placement = step?.placement || defaultPlacement;\n\n      let top = 0;\n      let left = 0;\n\n      switch (placement) {\n        case 'top':\n          top = targetRect.top - popupRect.height - 12;\n          left = targetRect.left + (targetRect.width / 2) - (popupRect.width / 2);\n          break;\n        case 'right':\n          top = targetRect.top + (targetRect.height / 2) - (popupRect.height / 2);\n          left = targetRect.right + 12;\n          break;\n        case 'left':\n          top = targetRect.top + (targetRect.height / 2) - (popupRect.height / 2);\n          left = targetRect.left - popupRect.width - 12;\n          break;\n        case 'bottom':\n        default:\n          top = targetRect.bottom + 12;\n          left = targetRect.left + (targetRect.width / 2) - (popupRect.width / 2);\n          break;\n      }\n\n      // Keep within viewport\n      top = Math.max(12, Math.min(top, window.innerHeight - popupRect.height - 12));\n      left = Math.max(12, Math.min(left, window.innerWidth - popupRect.width - 12));\n\n      setPopupPosition({\n        top: top + window.pageYOffset,\n        left: left + window.pageXOffset,\n      });\n      setPopupPlacement(placement);\n    };\n\n    updatePosition();\n\n    // Update on scroll/resize\n    window.addEventListener('scroll', updatePosition);\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('scroll', updatePosition);\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [open, targetElement, step, defaultPlacement]);\n\n  // Keyboard navigation\n  useEffect(() => {\n    if (!open) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      switch (e.key) {\n        case 'Escape':\n          onClose();\n          break;\n        case 'ArrowRight':\n        case 'Enter':\n        case ' ':\n          if (e.key === ' ') e.preventDefault();\n          handleNext();\n          break;\n        case 'ArrowLeft':\n          handlePrev();\n          break;\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [open, currentStep, steps.length]);\n\n  // Prevent body scroll when tour is open\n  useEffect(() => {\n    if (open) {\n      const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;\n      document.body.style.overflow = 'hidden';\n      document.body.style.paddingRight = `${scrollbarWidth}px`;\n    } else {\n      document.body.style.overflow = '';\n      document.body.style.paddingRight = '';\n    }\n\n    return () => {\n      document.body.style.overflow = '';\n      document.body.style.paddingRight = '';\n    };\n  }, [open]);\n\n  const handleNext = () => {\n    if (currentStep < steps.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      // Finish tour\n      onFinish?.();\n      onClose();\n    }\n  };\n\n  const handlePrev = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleSkip = () => {\n    onSkip?.();\n    onClose();\n  };\n\n  const handleClose = () => {\n    onClose();\n  };\n\n  if (!open || steps.length === 0) return null;\n\n  const isFirstStep = currentStep === 0;\n  const isLastStep = currentStep === steps.length - 1;\n\n  return createPortal(\n    <>\n      {/* Mask overlay */}\n      {mask && (\n        <div\n          className={`${styles.tourMask} ${styles.tourMaskVisible}`}\n          aria-hidden=\"true\"\n        />\n      )}\n\n      {/* Tour popup */}\n      <div\n        ref={popupRef}\n        className={`${styles.tourPopup} ${styles.tourPopupVisible}`}\n        style={{\n          top: `${popupPosition.top}px`,\n          left: `${popupPosition.left}px`,\n        }}\n        data-placement={popupPlacement}\n        role=\"dialog\"\n        aria-modal=\"false\"\n        aria-label={ariaLabel}\n        aria-describedby=\"tour-content\"\n      >\n        {/* Header */}\n        <div className={styles.tourHeader}>\n          {showProgress && (\n            <div className={styles.tourProgress} aria-live=\"polite\">\n              {currentStep + 1} / {steps.length}\n            </div>\n          )}\n          {closable && (\n            <button\n              className={styles.tourClose}\n              onClick={handleClose}\n              aria-label=\"Close tour\"\n            >\n              <X size={20} />\n            </button>\n          )}\n        </div>\n\n        {/* Content */}\n        <div className={styles.tourContent} id=\"tour-content\">\n          <h4 className={styles.tourTitle}>{step.title}</h4>\n          <div className={styles.tourDescription}>{step.content}</div>\n        </div>\n\n        {/* Footer */}\n        <div className={styles.tourFooter}>\n          {showSkip ? (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleSkip}\n              className={styles.tourSkip}\n            >\n              Skip\n            </Button>\n          ) : (\n            <span />\n          )}\n          <div className={styles.tourNav}>\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={handlePrev}\n              disabled={isFirstStep}\n              className={styles.tourPrev}\n            >\n              Previous\n            </Button>\n            <Button\n              variant=\"primary\"\n              size=\"sm\"\n              onClick={handleNext}\n              className={styles.tourNext}\n            >\n              {isLastStep ? 'Finish' : 'Next'}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </>,\n    document.body\n  );\n};\n\nTour.displayName = 'Tour';\n"],"names":["Tour","open","steps","controlledCurrent","onChange","onClose","onFinish","onSkip","mask","closable","showSkip","showProgress","defaultPlacement","ariaLabel","uncontrolledCurrent","setUncontrolledCurrent","useState","popupPosition","setPopupPosition","popupPlacement","setPopupPlacement","popupRef","useRef","previousFocusRef","targetElement","setTargetElement","isControlled","currentStep","setCurrentStep","index","step","useEffect","styles","el","target","updatePosition","targetRect","popupRect","placement","top","left","handleKeyDown","e","handleNext","handlePrev","scrollbarWidth","handleSkip","handleClose","isFirstStep","isLastStep","createPortal","jsxs","Fragment","jsx","X","Button"],"mappings":"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"}