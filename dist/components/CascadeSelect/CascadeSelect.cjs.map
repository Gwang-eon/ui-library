{"version":3,"file":"CascadeSelect.cjs","sources":["../../../src/components/CascadeSelect/CascadeSelect.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, type HTMLAttributes } from 'react';\nimport { ChevronDown, ChevronRight } from 'lucide-react';\nimport styles from './CascadeSelect.module.css';\n\nexport interface CascadeOption {\n  /**\n   * Option label\n   */\n  label: string;\n\n  /**\n   * Option value\n   */\n  value: string;\n\n  /**\n   * Child options for nested selection\n   */\n  children?: CascadeOption[];\n\n  /**\n   * Disabled state\n   */\n  disabled?: boolean;\n}\n\nexport interface CascadeSelectProps extends Omit<HTMLAttributes<HTMLDivElement>, 'onChange'> {\n  /**\n   * Hierarchical options data\n   */\n  options: CascadeOption[];\n\n  /**\n   * Selected value path (array of values from root to leaf)\n   */\n  value?: string[];\n\n  /**\n   * Change handler - receives array of selected values\n   */\n  onChange?: (value: string[], labels: string[]) => void;\n\n  /**\n   * Placeholder text\n   */\n  placeholder?: string;\n\n  /**\n   * Disabled state\n   */\n  disabled?: boolean;\n\n  /**\n   * Additional CSS class\n   */\n  className?: string;\n}\n\n/**\n * CascadeSelect component for hierarchical data selection\n *\n * @example\n * ```tsx\n * const locations = [\n *   {\n *     label: 'Building A',\n *     value: 'building-a',\n *     children: [\n *       { label: 'Floor 1', value: 'floor-1', children: [...] }\n *     ]\n *   }\n * ];\n *\n * <CascadeSelect\n *   options={locations}\n *   value={['building-a', 'floor-1', 'zone-a']}\n *   onChange={(values, labels) => console.log(values, labels)}\n *   placeholder=\"Select location...\"\n * />\n * ```\n */\nexport const CascadeSelect: React.FC<CascadeSelectProps> = ({\n  options,\n  value = [],\n  onChange,\n  placeholder = 'Select...',\n  disabled = false,\n  className = '',\n  ...rest\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedPath, setSelectedPath] = useState<string[]>(value);\n  const [hoveredPath, setHoveredPath] = useState<string[]>([]);\n  const [hoveredOptionRefs, setHoveredOptionRefs] = useState<Map<number, HTMLDivElement>>(new Map());\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n        setHoveredPath([]);\n        setHoveredOptionRefs(new Map());\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isOpen]);\n\n  // Get display text from selected path\n  const getDisplayText = () => {\n    if (selectedPath.length === 0) return placeholder;\n\n    const labels: string[] = [];\n    let currentOptions = options;\n\n    for (const val of selectedPath) {\n      const option = currentOptions.find((opt) => opt.value === val);\n      if (option) {\n        labels.push(option.label);\n        currentOptions = option.children || [];\n      }\n    }\n\n    return labels.join(' / ');\n  };\n\n  // Get options for a specific level based on hovered or selected path\n  const getOptionsForLevel = (level: number): CascadeOption[] => {\n    if (level === 0) return options;\n\n    // Use hoveredPath if available, otherwise use selectedPath\n    const pathToUse = hoveredPath.length >= level ? hoveredPath : selectedPath;\n\n    let currentOptions = options;\n    for (let i = 0; i < level; i++) {\n      const val = pathToUse[i];\n      if (!val) return [];\n\n      const option = currentOptions.find((opt) => opt.value === val);\n      if (option?.children) {\n        currentOptions = option.children;\n      } else {\n        return [];\n      }\n    }\n\n    return currentOptions;\n  };\n\n  // Calculate how many levels should be visible\n  const getVisibleLevels = (): number => {\n    // Start with level 0 (always visible)\n    let levels = 1;\n\n    // Use hoveredPath if hovering, otherwise use selectedPath\n    const pathToCheck = hoveredPath.length > 0 ? hoveredPath : selectedPath;\n\n    let currentOptions = options;\n    for (const val of pathToCheck) {\n      const option = currentOptions.find((opt) => opt.value === val);\n      if (option?.children && option.children.length > 0) {\n        levels++;\n        currentOptions = option.children;\n      } else {\n        break;\n      }\n    }\n\n    return levels;\n  };\n\n  // Handle option hover\n  const handleOptionHover = (option: CascadeOption, level: number, element: HTMLDivElement | null) => {\n    if (option.disabled) return;\n\n    // Build the new hover path up to this level\n    const newPath = [\n      ...hoveredPath.slice(0, level),\n      option.value\n    ];\n\n    setHoveredPath(newPath);\n\n    // Store the hovered element reference for positioning\n    if (element) {\n      setHoveredOptionRefs(prev => {\n        const next = new Map(prev);\n        next.set(level, element);\n        return next;\n      });\n    }\n  };\n\n  // Handle option click\n  const handleOptionClick = (option: CascadeOption, level: number) => {\n    if (option.disabled) return;\n\n    // Build the path up to this level\n    const newPath = [\n      ...hoveredPath.slice(0, level),\n      option.value\n    ];\n\n    // If this is a leaf node (no children), complete the selection\n    if (!option.children || option.children.length === 0) {\n      setSelectedPath(newPath);\n      setIsOpen(false);\n      setHoveredPath([]);\n      setHoveredOptionRefs(new Map());\n\n      // Build labels array\n      const labels: string[] = [];\n      let currentOptions = options;\n      for (const val of newPath) {\n        const opt = currentOptions.find((o) => o.value === val);\n        if (opt) {\n          labels.push(opt.label);\n          currentOptions = opt.children || [];\n        }\n      }\n\n      onChange?.(newPath, labels);\n    } else {\n      // If has children, just update hover state (already done by hover handler)\n      setHoveredPath(newPath);\n    }\n  };\n\n  // Check if option is in selected path\n  const isSelected = (optionValue: string, level: number): boolean => {\n    return selectedPath[level] === optionValue;\n  };\n\n  // Check if option is in hovered path\n  const isActive = (optionValue: string, level: number): boolean => {\n    return hoveredPath[level] === optionValue;\n  };\n\n  const containerClasses = [\n    styles['cascade-select'],\n    isOpen && styles.open,\n    disabled && styles.disabled,\n    className,\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  const triggerClasses = [\n    styles['cascade-trigger'],\n    selectedPath.length === 0 && styles.placeholder,\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  const visibleLevels = isOpen ? getVisibleLevels() : 0;\n\n  return (\n    <div ref={containerRef} className={containerClasses} {...rest}>\n      {/* Trigger Button */}\n      <button\n        type=\"button\"\n        className={triggerClasses}\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n        disabled={disabled}\n        aria-haspopup=\"listbox\"\n        aria-expanded={isOpen}\n      >\n        {getDisplayText()}\n        <ChevronDown className={styles['select-icon']} size={18} />\n      </button>\n\n      {/* Dropdown Panel */}\n      {isOpen && (\n        <div className={styles['cascade-panel']}>\n          {Array.from({ length: visibleLevels }).map((_, level) => {\n            const levelOptions = getOptionsForLevel(level);\n            if (levelOptions.length === 0) return null;\n\n            const subpanelClasses = [\n              styles['cascade-subpanel'],\n              level > 0 && styles.nested,\n              level > 0 && styles.show,\n            ]\n              .filter(Boolean)\n              .join(' ');\n\n            // Calculate top position based on the hovered option in the previous level\n            let topOffset = 0;\n            if (level > 0) {\n              const hoveredElement = hoveredOptionRefs.get(level - 1);\n              if (hoveredElement) {\n                topOffset = hoveredElement.offsetTop;\n              }\n            }\n\n            const subpanelStyle: React.CSSProperties =\n              level > 0\n                ? {\n                    position: 'absolute',\n                    left: `${level * 100}%`,\n                    top: topOffset,\n                  }\n                : {};\n\n            return (\n              <div key={level} className={subpanelClasses} style={subpanelStyle}>\n                {levelOptions.map((option) => {\n                  const hasChildren = option.children && option.children.length > 0;\n                  const optionClasses = [\n                    styles['cascade-option'],\n                    isSelected(option.value, level) && styles.selected,\n                    isActive(option.value, level) && styles.active,\n                    option.disabled && styles.disabled,\n                  ]\n                    .filter(Boolean)\n                    .join(' ');\n\n                  return (\n                    <div\n                      key={option.value}\n                      className={optionClasses}\n                      onClick={() => handleOptionClick(option, level)}\n                      onMouseEnter={(e) => handleOptionHover(option, level, e.currentTarget)}\n                      role=\"option\"\n                      aria-selected={isSelected(option.value, level)}\n                      aria-disabled={option.disabled}\n                    >\n                      <span>{option.label}</span>\n                      {hasChildren && <ChevronRight className={styles['option-arrow']} size={16} />}\n                    </div>\n                  );\n                })}\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n};\n\nCascadeSelect.displayName = 'CascadeSelect';\n\nexport default CascadeSelect;\n"],"names":["CascadeSelect","options","value","onChange","placeholder","disabled","className","rest","isOpen","setIsOpen","useState","selectedPath","setSelectedPath","hoveredPath","setHoveredPath","hoveredOptionRefs","setHoveredOptionRefs","containerRef","useRef","useEffect","handleClickOutside","event","getDisplayText","labels","currentOptions","val","option","opt","getOptionsForLevel","level","pathToUse","i","getVisibleLevels","levels","pathToCheck","handleOptionHover","element","newPath","prev","next","handleOptionClick","o","isSelected","optionValue","isActive","containerClasses","styles","triggerClasses","visibleLevels","jsxs","ChevronDown","jsx","_","levelOptions","subpanelClasses","topOffset","hoveredElement","subpanelStyle","hasChildren","optionClasses","e","ChevronRight"],"mappings":"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"}